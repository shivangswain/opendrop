(this["webpackJsonp@opendrop/client"]=this["webpackJsonp@opendrop/client"]||[]).push([[0],{108:function(e,t,n){},111:function(e,t,n){},200:function(e,t,n){"use strict";n.r(t);var r,c,a=n(0),s=n.n(a),i=n(21),o=n.n(i),u=n(11),l=(n(108),n(15)),b=(n(109),n(110),n(111),n(34)),d=n(2),f=function(){return Object(d.jsx)("header",{children:Object(d.jsx)("nav",{className:"menu",children:Object(d.jsx)("h1",{children:Object(d.jsx)(b.c,{to:"/",className:"logo",children:"OpenDrop"})})})})},O=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_SERVER||"ws://"+window.location.hostname+":5000/ws",j=Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}).REACT_APP_USE_BROWSER_ROUTER?b.a:b.b,E=function(){var e=Object(u.c)((function(e){return e.networkName})),t=Object(u.c)((function(e){return e.connected})),n=Object(u.c)((function(e){return e.clientId})),r=Object(u.c)((function(e){return e.suggestedName})),c=Object(l.f)(),s="ABCDEFGHIJKLMNOPQRTUVWXYZ";return Object(a.useEffect)((function(){var a=e||r||new Array(5).fill("").map((function(){return s.charAt(Math.floor(Math.random()*s.length))})).join("");t&&n&&c.replace("/"+a)}),[t,e,c,n,r]),Object(d.jsx)("section",{className:"center",children:"Loading..."})},p=n(57),x=n(40),N=n(33),C=n(205),T=n(90),v=n.n(T),h=n(55),I=n.n(h),S=n(14),R=!!navigator.share,_=function(e){var t=e.href,n=Object(a.useState)(!1),r=Object(N.a)(n,2),c=r[0],s=r[1],i=Object(a.useCallback)((function(){return s(!0)}),[s]),o=Object(a.useCallback)((function(){navigator.share({title:"OpenDrop - transfer files",url:t})}),[t]);return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Connect"}),Object(d.jsxs)("div",{className:"qrcode subsection",children:[Object(d.jsx)("div",{className:"info",children:Object(d.jsx)(d.Fragment,{children:"To connect to your network and start copying files, scan the QR code below, or open the URL on another device."})}),Object(d.jsx)("div",{children:Object(d.jsx)(v.a,{value:t})}),Object(d.jsxs)("div",{children:[Object(d.jsx)("pre",{children:t}),Object(d.jsxs)("div",{className:"buttons",children:[Object(d.jsx)(I.a,{text:t,onCopy:i,children:Object(d.jsxs)("button",{children:[Object(d.jsx)(S.f,{})," ",c?"Copied":"Copy"]})}),R&&Object(d.jsxs)("button",{onClick:o,children:[Object(d.jsx)(S.q,{})," Share"]})]})]})]})]})},m=n(13),A=n(203),w=n(56),k=n(94),y=n.n(k);function D(e){return{type:r.ADD_TRANSFER,value:e}}function g(e){return{type:r.UPDATE_TRANSFER,value:e}}function M(e){return{type:r.REMOVE_TRANSFER,value:e}}function L(e){return{type:r.ACCEPT_TRANSFER,value:e}}function P(e){return{type:r.REJECT_TRANSFER,value:e}}function G(e){return{type:r.CANCEL_TRANSFER,value:e}}function F(e,t){return{type:r.CREATE_TRANSFER,value:{file:e,clientId:t}}}function W(e,t){return{type:r.ADD_ICE_CANDIDATE,value:{transferId:e,data:t}}}!function(e){e.SET_ERROR="SET_ERROR",e.SET_CONNECTED="SET_CONNECTED",e.SET_RTC_CONFIGURATION="SET_RTC_CONFIGURATION",e.SET_NETWORK_NAME="SET_NETWORK_NAME",e.SET_CLIENT_ID="SET_CLIENT_ID",e.SET_CLIENT_COLOR="SET_CLIENT_COLOR",e.SET_SUGGESTED_NAME="SET_SUGGESTED_NAME",e.SET_NETWORK="SET_NETWORK",e.SET_MAX_SIZE="SET_MAX_SIZE",e.SET_NOTICE="SET_NOTICE",e.SET_KEY_PAIR="SET_KEY_PAIR",e.DISMISS_ERROR="DISMISS_ERROR",e.DISMISS_WELCOME="DISMISS_WELCOME",e.PREPARE_MESSAGE="PREPARE_MESSAGE",e.WS_SEND_MESSAGE="WS_SEND_MESSAGE",e.WS_MESSAGE="WS_MESSAGE",e.WS_CONNECTED="WS_CONNECTED",e.WS_DISCONNECTED="WS_DISCONNECTED",e.WS_CONNECT="WS_CONNECT",e.ADD_TRANSFER="ADD_TRANSFER",e.REMOVE_TRANSFER="REMOVE_TRANSFER",e.UPDATE_TRANSFER="UPDATE_TRANSFER",e.ACCEPT_TRANSFER="ACCEPT_TRANSFER",e.REJECT_TRANSFER="REJECT_TRANSFER",e.CREATE_TRANSFER="CREATE_TRANSFER",e.CANCEL_TRANSFER="CANCEL_TRANSFER",e.ADD_ICE_CANDIDATE="ADD_ICE_CANDIDATE",e.SET_LOCAL_DESCRIPTION="SET_LOCAL_DESCRIPTION",e.SET_REMOTE_DESCRIPTION="SET_REMOTE_DESCRIPTION"}(r||(r={})),function(e){e[e.INCOMING=0]="INCOMING",e[e.OUTGOING=1]="OUTGOING",e[e.CONNECTING=2]="CONNECTING",e[e.CONNECTED=3]="CONNECTED",e[e.IN_PROGRESS=4]="IN_PROGRESS",e[e.COMPLETE=5]="COMPLETE",e[e.FAILED=6]="FAILED"}(c||(c={}));var U,K=n(30),z=(U={},Object(K.a)(U,c.INCOMING,"Incoming"),Object(K.a)(U,c.OUTGOING,"Outgoing"),Object(K.a)(U,c.CONNECTING,"Connecting..."),Object(K.a)(U,c.CONNECTED,"Connected!"),Object(K.a)(U,c.IN_PROGRESS,"In progress..."),Object(K.a)(U,c.COMPLETE,"Complete!"),Object(K.a)(U,c.FAILED,"Failed!"),U),Y=function(e){var t,n=e.transfer,r=Object(u.c)((function(e){return e.network})).find((function(e){return e.clientId===n.clientId}));return Object(d.jsxs)("div",{className:"transfer-icon",children:[r?Object(d.jsx)(w.a,{placement:"top",overlay:z[n.state],transitionName:"rc-tooltip-fade",children:Object(d.jsx)("div",{className:"network-tile target-tile",style:{backgroundColor:r.clientColor},"aria-label":"Transfer state: "+z[n.state],children:function(e,t){switch(e){case c.INCOMING:return Object(d.jsx)(S.c,{});case c.OUTGOING:return Object(d.jsx)(S.d,{});case c.FAILED:return Object(d.jsx)(S.r,{});case c.IN_PROGRESS:return t?Object(d.jsx)(S.a,{}):Object(d.jsx)(S.b,{});case c.CONNECTING:return Object(d.jsx)(S.n,{});case c.CONNECTED:return Object(d.jsx)(S.m,{});case c.COMPLETE:return Object(d.jsx)(S.e,{})}}(n.state,n.receiving)})}):null,n.preview?Object(d.jsx)("img",{src:n.preview,alt:"Preview: "+n.fileName}):(t=n.fileType,t.startsWith("text/")||t.includes("pdf")?Object(d.jsx)(S.h,{}):t.includes("zip")||t.includes("rar")||t.includes("7z")||t.includes("compress")?Object(d.jsx)(S.i,{}):t.startsWith("image/")?Object(d.jsx)(S.k,{}):t.startsWith("video/")?Object(d.jsx)(S.l,{}):t.startsWith("audio/")?Object(d.jsx)(S.j,{}):t.startsWith("application/")?Object(d.jsx)(S.h,{}):Object(d.jsx)(S.g,{}))]})},J={type:"spring",stiffness:200,damping:20},V={initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:J},B={initial:{scale:0},animate:{rotate:360,scale:1},exit:{scale:0},transition:J,positionTransition:!0},H={initial:{x:-100,opacity:0},animate:{x:0,opacity:1},exit:{x:-100,opacity:0},transition:J,positionTransition:!0},X=[c.IN_PROGRESS,c.CONNECTING,c.CONNECTED,c.OUTGOING];function Z(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"\u2026",r=e.lastIndexOf("."),c=Math.floor(t/2);if(-1!==r){var a=e.substr(r),s=e.substr(0,r);if(s.length>t)return s.substr(0,c)+n+s.substr(s.length-(c+1))+a}else if(e.length>24)return e.substr(0,c)+n+e.substr(e.length-(c+1));return e}var q=function(e){var t=e.transfer,n=Object(u.b)(),r=Object(a.useState)(!1),s=Object(N.a)(r,2),i=s[0],o=s[1],l=Object(a.useState)(""),b=Object(N.a)(l,2),f=b[0],O=b[1],j=Object(a.useCallback)((function(){return n(L(t.transferId))}),[t,n]),E=Object(a.useCallback)((function(){return n(P(t.transferId))}),[t,n]),p=Object(a.useCallback)((function(){return n(G(t.transferId))}),[t,n]),x=Object(a.useCallback)((function(){return n(M(t.transferId))}),[t,n]);Object(a.useEffect)((function(){o(!1)}),[t.blobUrl,o]),Object(a.useEffect)((function(){"text/plain"===t.fileType&&t.blobUrl&&fetch(t.blobUrl).then((function(e){return e.text()})).then((function(e){return O(e)}))}),[t]);var T=Object(a.useCallback)((function(){return o(!0)}),[o]);return Object(d.jsxs)(A.a.li,Object(m.a)(Object(m.a)({className:"subsection info-grid"},H),{},{"aria-label":"Transfer",children:[Object(d.jsx)("div",{className:"image",children:Object(d.jsx)(Y,{transfer:t})}),Object(d.jsxs)("div",{className:"info",children:[Object(d.jsxs)("div",{children:[Object(d.jsx)(w.a,{placement:"top",overlay:t.fileName,transitionName:"rc-tooltip-fade",children:Object(d.jsxs)("div",{className:"metadata",children:[Z(t.fileName),Object(d.jsxs)("span",{children:[" (",y()(t.fileSize),")"]})]})}),Object(d.jsx)("div",{className:"metadata",children:t.state===c.FAILED?"Failed!":""})]}),Object(d.jsxs)("div",{className:"actions",children:[Object(d.jsxs)("div",{className:"buttons",children:[t.state===c.COMPLETE&&t.blobUrl?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("a",{className:"button",href:t.blobUrl,download:t.fileName,children:"Redownload"}),"text/plain"===t.fileType?Object(d.jsx)(I.a,{text:f,onCopy:T,children:Object(d.jsx)("button",{children:i?"Copied":"Copy to clipboard"})}):null]}):null,t.state===c.COMPLETE||t.state===c.FAILED?Object(d.jsx)("button",{onClick:x,children:"Dismiss"}):null,t.state===c.INCOMING?Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("button",{onClick:j,children:"Accept"}),Object(d.jsx)("button",{onClick:E,children:"Reject"})]}):null,X.includes(t.state)?Object(d.jsx)("button",{onClick:p,children:"Cancel"}):null]}),Object(d.jsx)(C.a,{children:t.state===c.IN_PROGRESS?Object(d.jsxs)(A.a.div,Object(m.a)(Object(m.a)({className:"progress"},H),{},{children:[Object(d.jsx)("progress",{value:t.progress,max:1}),Object(d.jsxs)("div",{children:[Math.round(t.speed/1e3)," kB/s"]})]})):null})]})]})]}))},Q=function(){var e=Object(u.c)((function(e){return e.transfers})),t=Object(u.b)(),n=Object(a.useCallback)((function(){e.filter((function(e){return e.state===c.INCOMING})).forEach((function(e){return t(L(e.transferId))}))}),[e,t]),r=Object(a.useCallback)((function(){e.filter((function(e){return e.state===c.INCOMING})).forEach((function(e){return t(P(e.transferId))}))}),[e,t]),s=Object(a.useCallback)((function(){e.filter((function(e){return X.includes(e.state)})).forEach((function(e){return t(G(e.transferId))}))}),[e,t]),i=Object(a.useCallback)((function(){e.filter((function(e){return e.state===c.COMPLETE||e.state===c.FAILED})).forEach((function(e){return t(M(e.transferId))}))}),[e,t]);return Object(d.jsxs)(d.Fragment,{children:[0!==e.length&&Object(d.jsxs)("h2",{children:["Transfers",Object(d.jsxs)("div",{className:"buttons",children:[!!e.find((function(e){return e.state===c.INCOMING}))&&Object(d.jsx)("button",{onClick:n,children:"Accept all"}),!!e.find((function(e){return e.state===c.INCOMING}))&&Object(d.jsx)("button",{onClick:r,children:"Reject all"}),!!e.find((function(e){return e.state===c.COMPLETE||e.state===c.FAILED}))&&Object(d.jsx)("button",{onClick:i,children:"Dismiss all"}),!!e.find((function(e){return X.includes(e.state)}))&&Object(d.jsx)("button",{onClick:s,children:"Cancel all"})]})]}),Object(d.jsx)("ul",{className:"center queue",children:Object(d.jsx)(C.a,{children:e.map((function(e){return Object(d.jsx)(q,{transfer:e},e.transferId)}))})})]})},$=n(98),ee=function(e){var t=e.client,n=e.onSelect,r=Object(u.b)(),c=Object(u.c)((function(e){return e.publicKey})),s=Object(a.useCallback)((function(e){var n,c=Object(x.a)(e);try{for(c.s();!(n=c.n()).done;){var a=n.value;r(F(a,t.clientId))}}catch(s){c.e(s)}finally{c.f()}}),[r,t.clientId]),i=Object($.a)({onDrop:s}),o=i.getRootProps,l=i.getInputProps,b=i.isDragActive,f=Object(a.useCallback)((function(){n(t.clientId)}),[t,n]);return Object(d.jsx)(A.a.div,Object(m.a)(Object(m.a)({},B),{},{onClick:n?f:null,children:n?Object(d.jsxs)("div",{className:"network-tile",style:{backgroundColor:t.clientColor},children:[Object(d.jsx)(S.p,{}),!!c&&!!t.publicKey&&Object(d.jsx)("div",{className:"secure",children:Object(d.jsx)(S.o,{})})]}):Object(d.jsxs)("div",Object(m.a)(Object(m.a)({},o()),{},{className:"network-tile "+(b?"active":""),style:{backgroundColor:t.clientColor},children:[Object(d.jsxs)("label",{onClick:function(e){e.preventDefault()},children:[Object(d.jsx)("input",Object(m.a)(Object(m.a)({},l({style:{}})),{},{accept:"*",tabIndex:1})),"Click on this area to start a transfer."]}),Object(d.jsx)(S.p,{}),t.publicKey&&Object(d.jsx)("div",{className:"secure",children:Object(d.jsx)(S.o,{})})]}))}))},te=function(e){var t=e.onSelect,n=Object(u.c)((function(e){return e.network}));return Object(d.jsx)("div",{className:"subsection "+(n.length>0?"network":""),children:Object(d.jsx)(C.a,{children:n.length>0?Object(d.jsx)(C.a,{children:n.map((function(e){return Object(d.jsx)(ee,{client:e,onSelect:t},e.clientId)}))}):Object(d.jsxs)(A.a.span,Object(m.a)(Object(m.a)({},V),{},{children:[Object(d.jsx)("div",{children:"Nobody is connected to your network."}),Object(d.jsx)("div",{children:"Open this website elsewhere to connect."})]}))})})},ne=function(){var e=Object(u.c)((function(e){return e.clientColor})),t=Object(u.c)((function(e){return e.noticeText})),n=Object(u.c)((function(e){return e.noticeUrl}));return Object(d.jsxs)("div",{children:[Object(d.jsx)("h2",{children:"Devices"}),!!t&&Object(d.jsx)("div",{className:"subsection notice",children:n?Object(d.jsx)("a",{href:n,children:t}):t}),Object(d.jsxs)("div",{className:"subsection info-grid",children:[Object(d.jsx)("div",{className:"image",children:Object(d.jsx)("div",{className:"network-tile",style:{backgroundColor:e},children:"You"})}),Object(d.jsxs)("div",{className:"info",children:[Object(d.jsx)("div",{children:Object(d.jsx)("strong",{children:"This is your tile."})}),Object(d.jsx)("div",{children:"Under this section you will see other tiles like this one. Drag and drop your files or click on them to initiate a file transfer."})]})]}),Object(d.jsx)(te,{}),Object(d.jsx)(Q,{})]})},re=function(){return Object(d.jsxs)(d.Fragment,{children:[Object(d.jsx)("h2",{children:"Incompatible browser"}),Object(d.jsx)("div",{className:"subsection warning",children:Object(d.jsx)("p",{children:"Your browser does not support the technologies required for the app to work. You can still try to use the app, but it's not guaranteed it'll work."})})]})},ce=function(e){var t=e.files,n=e.dismissClipboard,r=Object(u.b)(),c=Object(a.useCallback)((function(e){var c,a=Object(x.a)(t);try{for(a.s();!(c=a.n()).done;){var s=c.value;r(F(s,e))}}catch(i){a.e(i)}finally{a.f()}n()}),[r,t,n]);return Object(d.jsx)(A.a.div,Object(m.a)(Object(m.a)({className:"modal"},V),{},{children:Object(d.jsxs)("div",{children:[Object(d.jsxs)("section",{children:[Object(d.jsx)("h2",{children:"Send clipboard contents"}),Object(d.jsx)(te,{onSelect:c})]}),Object(d.jsx)("div",{className:"center",children:Object(d.jsx)("button",{onClick:n,children:"Cancel"})})]})}))},ae=function(){return Object(d.jsxs)("section",{children:[Object(d.jsx)("h2",{children:"Welcome"}),Object(d.jsxs)("div",{className:"subsection left",children:[Object(d.jsx)("p",{children:"Welcome to OpenDrop! Let me explain what this website is."}),Object(d.jsx)("p",{children:"This website allows you to copy files over the network (LAN if both devices are on the same local network and support WebRTC, otherwise the traffic goes through a TURN relay). Originally I've created this project to avoid logging into my e-mail on computers I don't own or having to type long URLs by hand. I hope it is as useful for you as it is for me. :)"}),Object(d.jsxs)("p",{children:["You can start a file transfer in a few easy steps:",Object(d.jsxs)("ol",{children:[Object(d.jsx)("li",{children:"Open this website on one device (you're here right now!)"}),Object(d.jsx)("li",{children:'Scan the QR code or open the URL from the "Invite" section on another device.'}),Object(d.jsx)("li",{children:'Drag and drop your files onto a tile (any tile that isn\'t marked as "You", you can also click on a tile to open a file selection dialog).'}),Object(d.jsx)("li",{children:"Accept the transfer on another device."})]})]}),Object(d.jsx)("p",{children:"Clicking the \"Continue\" button below this notice will save data (welcomed = '1') into your browser's local storage. This data will be used to avoid showing you this notice in future."})]})]})};function se(e){return{type:r.SET_CONNECTED,value:e}}function ie(e){return{type:r.SET_NETWORK_NAME,value:e}}var oe=function(){var e=Object(u.b)(),t=Object(a.useCallback)((function(){e({type:r.DISMISS_WELCOME,value:null})}),[e]);return Object(d.jsx)(A.a.div,Object(m.a)(Object(m.a)({className:"modal"},V),{},{children:Object(d.jsxs)("div",{children:[Object(d.jsx)(ae,{}),Object(d.jsx)("div",{className:"center",children:Object(d.jsx)("button",{onClick:t,children:"Continue"})})]})}))},ue=function(){var e=Object(u.b)(),t=Object(u.c)((function(e){return e.welcomed})),n=Object(a.useState)([]),r=Object(N.a)(n,2),c=r[0],s=r[1],i=Object(l.g)().networkName,o=Object(a.useState)(""),b=Object(N.a)(o,2),f=b[0],O=b[1],j=Object(a.useState)(!1),E=Object(N.a)(j,2),T=E[0],v=E[1];Object(a.useEffect)((function(){O(window.location.origin+window.location.pathname+window.location.hash),e(ie(i))}),[O,i,e]),Object(a.useEffect)((function(){v(!("RTCPeerConnection"in window&&"WebSocket"in window&&"FileReader"in window))}),[]),Object(a.useEffect)((function(){var e=function(e){if("TEXTAREA"!==e.target.tagName){var t,n=[],r=Object(x.a)(e.clipboardData.items);try{for(r.s();!(t=r.n()).done;){var c=t.value,a=c.getAsFile();a?n.push(a):"text/plain"===c.type&&c.getAsString((function(e){s((function(t){return[].concat(Object(p.a)(t),[new File([e],"clipboard.txt",{type:"text/plain"})])}))}))}}catch(i){r.e(i)}finally{r.f()}s(n)}};return document.addEventListener("paste",e),function(){document.removeEventListener("paste",e)}}));var h=Object(a.useCallback)((function(){s([])}),[s]);return Object(d.jsxs)(d.Fragment,{children:[T?Object(d.jsx)(re,{}):null,Object(d.jsx)(C.a,{children:t?null:Object(d.jsx)(oe,{})}),Object(d.jsx)(C.a,{children:c.length>0?Object(d.jsx)(ce,{files:c,dismissClipboard:h}):null}),Object(d.jsxs)("section",{className:"desktop-2col",children:[Object(d.jsx)(ne,{}),Object(d.jsx)(_,{href:f})]})]})},le=function(){var e=Object(u.c)((function(e){return e.connected}));return Object(d.jsx)(C.a,{children:e?null:Object(d.jsx)(A.a.div,Object(m.a)(Object(m.a)({},V),{},{className:"status error",children:Object(d.jsx)("div",{children:"Connecting..."})}))})},be=function(){return Object(d.jsx)(j,{children:Object(d.jsxs)("div",{className:"app",children:[Object(d.jsx)(f,{}),Object(d.jsx)(le,{}),Object(d.jsxs)(l.c,{children:[Object(d.jsx)(l.a,{path:"/:networkName",children:Object(d.jsx)(ue,{})}),Object(d.jsx)(l.a,{path:"/",children:Object(d.jsx)(E,{})})]})]})})},de=n(45),fe=n(99),Oe=n(96);function je(e){return{type:r.PREPARE_MESSAGE,value:e}}function Ee(e){return{type:r.WS_MESSAGE,value:e}}var pe=function(e){return function(t){var n=new Oe.TypeSocket(e,{maxRetries:0,retryOnClose:!0,retryTime:500});return n.on("connected",(function(){return t.dispatch({type:r.WS_CONNECTED,value:null})})),n.on("disconnected",(function(){return t.dispatch({type:r.WS_DISCONNECTED,value:null})})),n.on("message",(function(e){return t.dispatch(Ee(e))})),function(e){return function(t){return t.type&&(t.type===r.WS_SEND_MESSAGE&&1===n.readyState&&n.send(t.value),t.type===r.WS_CONNECT&&0===n.readyState&&n.connect()),e(t)}}}},xe={welcomed:"1"===localStorage.getItem("welcomed"),connected:!1,rtcConfiguration:null,error:null,networkName:null,clientId:null,clientColor:null,suggestedName:null,network:[],transfers:[],maxSize:0};var Ne,Ce,Te=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:xe,t=arguments.length>1?arguments[1]:void 0,n=Object(m.a)({},e);switch(t.type){case r.SET_ERROR:n.error=t.value;break;case r.DISMISS_ERROR:n.error=null;break;case r.DISMISS_WELCOME:n.welcomed=!0;break;case r.SET_CONNECTED:n.connected=t.value;break;case r.SET_RTC_CONFIGURATION:var c=t.value;c.iceServers?n.rtcConfiguration={iceServers:c.iceServers}:n.rtcConfiguration=null;break;case r.SET_NETWORK_NAME:n.networkName=t.value;break;case r.SET_CLIENT_ID:n.clientId=t.value;break;case r.SET_CLIENT_COLOR:n.clientColor=t.value;break;case r.SET_MAX_SIZE:n.maxSize=t.value;break;case r.SET_SUGGESTED_NAME:n.suggestedName=t.value;break;case r.SET_KEY_PAIR:var a=t.value;n.publicKey=a.publicKey,n.privateKey=a.privateKey;break;case r.SET_NETWORK:n.network=t.value,n.network=n.network.filter((function(e){return e.clientId!==n.clientId}));var s=n.network.map((function(e){return e.clientId}));n.transfers=n.transfers.filter((function(e){return!e.clientId||s.includes(e.clientId)}));break;case r.SET_NOTICE:var i=t.value;n.noticeText=i.noticeText,n.noticeUrl=i.noticeUrl;break;case r.ADD_TRANSFER:n.transfers=[].concat(Object(p.a)(n.transfers),[t.value]);break;case r.REMOVE_TRANSFER:n.transfers=n.transfers.filter((function(e){return e.transferId!==t.value}));break;case r.SET_REMOTE_DESCRIPTION:n.transfers=n.transfers.map((function(e){var n=e.peerConnection;return e.transferId===t.value.transferId&&n&&"disconnected"!==n.connectionState&&"failed"!==n.connectionState&&e.peerConnection.setRemoteDescription(t.value.data).catch((function(){})),e}));break;case r.ADD_ICE_CANDIDATE:n.transfers=n.transfers.map((function(e){var n=e.peerConnection;return e.transferId===t.value.transferId&&n&&"disconnected"!==n.connectionState&&"failed"!==n.connectionState&&e.peerConnection.addIceCandidate(t.value.data).catch((function(){})),e}));break;case r.UPDATE_TRANSFER:n.transfers=n.transfers.map((function(e){return e.transferId===t.value.transferId?Object(m.a)(Object(m.a)({},e),t.value):e}));break;default:return e}return n.transfers=n.transfers.sort((function(e,t){return t.state-e.state})),n},ve=n(5),he=n.n(ve),Ie=n(28),Se=n(4),Re=n(204),_e=n(97),me=n(58);!function(e){e.WELCOME="welcome",e.NAME="name",e.TRANSFER="transfer",e.ACTION="action",e.NETWORK="network",e.PING="ping",e.RTC_DESCRIPTION="rtcDescription",e.RTC_CANDIDATE="rtcCandidate",e.ENCRYPTED="encrypted"}(Ne||(Ne={})),function(e){e.ACCEPT="accept",e.REJECT="reject",e.CANCEL="cancel"}(Ce||(Ce={}));var Ae=he.a.mark(we);function we(e,t){var n,r,a,s,i,o,u,l,b,d,f,O;return he.a.wrap((function(j){for(;;)switch(j.prev=j.next){case 0:return j.next=2,Object(Se.b)(g({transferId:e.transferId,state:c.CONNECTING}));case 2:return j.next=4,Object(Se.c)((function(e){return e.transfers}));case 4:if(r=j.sent,a=r.filter((function(t){return t.transferId===e.transferId})),0!==a.length){j.next=8;break}return j.abrupt("return");case 8:if((s=a[0])&&s.file){j.next=11;break}return j.abrupt("return");case 11:return i=s.file,j.next=14,Object(Se.c)((function(e){return e.rtcConfiguration}));case 14:return o=j.sent,u=new RTCPeerConnection(o),j.next=18,Object(Se.b)(g({transferId:s.transferId,peerConnection:u}));case 18:u.addEventListener("negotiationneeded",Object(Ie.a)(he.a.mark((function e(){var n,r;return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u.createOffer();case 2:return n=e.sent,e.next=5,u.setLocalDescription(n);case 5:r={type:Ne.RTC_DESCRIPTION,transferId:s.transferId,targetId:s.clientId,data:{type:u.localDescription.type,sdp:u.localDescription.sdp}},t(je(r));case 7:case"end":return e.stop()}}),e)})))),u.addEventListener("icecandidate",(function(e){if(e&&e.candidate){var n={type:Ne.RTC_CANDIDATE,targetId:s.clientId,transferId:s.transferId,data:e.candidate};t(je(n))}})),(l=u.createDataChannel("sendDataChannel")).binaryType="arraybuffer",b=(new Date).getTime()/1e3,d=!1,f=function(){d=!0,t(g({transferId:s.transferId,state:c.FAILED,progress:1,speed:0}))},O=(null===(n=u.sctp)||void 0===n?void 0:n.maxMessageSize)||65535,l.addEventListener("open",(function(){t(g({transferId:s.transferId,state:c.CONNECTED}));var e=new FileReader,n=0,r=function(t){var r=i.slice(n,t+O);e.readAsArrayBuffer(r)};e.addEventListener("load",(function(e){if(!d){var a=e.target.result;try{l.send(a)}catch(o){return f(),void l.close()}n+=a.byteLength,t(g({transferId:s.transferId,state:c.IN_PROGRESS,progress:n/i.size,speed:n/((new Date).getTime()/1e3-b)})),n>=i.size?(t(g({transferId:s.transferId,state:c.COMPLETE,progress:1,speed:0,time:Math.floor((new Date).getTime()/1e3-b)})),d=!0):l.bufferedAmount<O/2&&r(n)}})),l.bufferedAmountLowThreshold=O/2,l.addEventListener("bufferedamountlow",(function(){return r(n)})),r(0)})),l.addEventListener("close",(function(){d||f(),u.close()})),u.addEventListener("iceconnectionstatechange",(function(){"failed"!==u.iceConnectionState&&"disconnected"!==u.iceConnectionState||d||f()}));case 29:case"end":return j.stop()}}),Ae)}var ke=he.a.mark(ye);function ye(e,t){var n,r,a,s,i,o,u,l,b,d,f,O,j;return he.a.wrap((function(E){for(;;)switch(E.prev=E.next){case 0:return E.next=2,Object(Se.c)((function(e){return e.transfers}));case 2:if(n=E.sent,r=n.filter((function(t){return t.transferId===e.transferId})),0!==r.length){E.next=6;break}return E.abrupt("return");case 6:if(a=r[0]){E.next=9;break}return E.abrupt("return");case 9:return E.next=11,Object(Se.c)((function(e){return e.rtcConfiguration}));case 11:return s=E.sent,i=new RTCPeerConnection(s),E.next=15,Object(Se.b)(g({transferId:a.transferId,peerConnection:i}));case 15:return i.addEventListener("icecandidate",(function(e){if(e&&e.candidate){var n={type:Ne.RTC_CANDIDATE,targetId:a.clientId,transferId:a.transferId,data:e.candidate};t(je(n))}})),o=(new Date).getTime()/1e3,u=[],l=0,b=!1,d=function(){b=!0,t(g({transferId:a.transferId,state:c.FAILED,progress:1,speed:0}))},f=function(){b=!0;var e=new Blob(u),n=URL.createObjectURL(e);t(g({transferId:a.transferId,state:c.COMPLETE,progress:1,speed:0,time:Math.floor((new Date).getTime()/1e3-o),blobUrl:n}));var r=document.createElement("a");r.setAttribute("href",n),r.setAttribute("download",a.fileName),r.style.display="none",r.click(),i.close()},i.addEventListener("datachannel",(function(e){t(g({transferId:a.transferId,state:c.CONNECTED}));var n=e.channel;n.binaryType="arraybuffer",n.addEventListener("message",(function(e){u.push(e.data),l+=e.data.byteLength,t(g({transferId:a.transferId,state:c.IN_PROGRESS,progress:l/a.fileSize,speed:l/((new Date).getTime()/1e3-o)})),l>=a.fileSize&&(f(),n.close())})),n.addEventListener("close",(function(){l<a.fileSize?d():b||f()}))})),i.addEventListener("iceconnectionstatechange",(function(){"failed"!==i.iceConnectionState&&"disconnected"!==i.iceConnectionState||b||d()})),E.next=26,Object(Se.a)(Object(Ie.a)(he.a.mark((function t(){return he.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,i.setRemoteDescription(e.data);case 2:return t.abrupt("return",t.sent);case 3:case"end":return t.stop()}}),t)}))));case 26:return E.next=28,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.createAnswer();case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 28:return O=E.sent,E.next=31,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,i.setLocalDescription(O);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 31:return j={type:Ne.RTC_DESCRIPTION,transferId:a.transferId,targetId:a.clientId,data:{type:i.localDescription.type,sdp:i.localDescription.sdp}},E.next=34,Object(Se.b)(je(j));case 34:case"end":return E.stop()}}),ke)}var De=he.a.mark(Ve),ge=he.a.mark(Be),Me=he.a.mark(He),Le=he.a.mark(Xe),Pe=he.a.mark(Ze),Ge=he.a.mark(qe),Fe=he.a.mark(Qe),We=he.a.mark($e),Ue=he.a.mark(et),Ke=he.a.mark(tt),ze=he.a.mark(nt),Ye=he.a.mark(rt),Je=he.a.mark(ct);function Ve(e,t){var n,a,s,i,o,u,l;return he.a.wrap((function(b){for(;;)switch(b.prev=b.next){case 0:a=e.value,b.t0=a.type,b.next=b.t0===Ne.WELCOME?4:b.t0===Ne.TRANSFER?23:b.t0===Ne.ACTION?27:b.t0===Ne.NETWORK?37:b.t0===Ne.PING?40:b.t0===Ne.RTC_DESCRIPTION?44:b.t0===Ne.RTC_CANDIDATE?52:b.t0===Ne.ENCRYPTED?55:74;break;case 4:return b.next=6,Object(Se.b)((T=a.rtcConfiguration,{type:r.SET_RTC_CONFIGURATION,value:T}));case 6:return b.next=8,Object(Se.b)((C=a.suggestedName,{type:r.SET_SUGGESTED_NAME,value:C}));case 8:return b.next=10,Object(Se.b)((N=a.clientId,{type:r.SET_CLIENT_ID,value:N}));case 10:return b.next=12,Object(Se.b)((x=a.clientColor,{type:r.SET_CLIENT_COLOR,value:x}));case 12:return b.next=14,Object(Se.b)((p=a.maxSize,{type:r.SET_MAX_SIZE,value:p}));case 14:return b.next=16,Object(Se.b)((j=a.noticeText,E=a.noticeUrl,{type:r.SET_NOTICE,value:{noticeText:j,noticeUrl:E}}));case 16:return b.next=18,Object(Se.c)((function(e){return e.networkName}));case 18:if(!(s=b.sent)||""===s){b.next=22;break}return b.next=22,Object(Se.b)(ie(s));case 22:return b.abrupt("break",74);case 23:return i={fileName:a.fileName,fileType:a.fileType,fileSize:a.fileSize,transferId:a.transferId,clientId:a.clientId,state:c.INCOMING,preview:(null===(n=a.preview)||void 0===n?void 0:n.startsWith("data:"))?a.preview:void 0,receiving:!0},b.next=26,Object(Se.b)(D(i));case 26:return b.abrupt("break",74);case 27:b.t1=a.action,b.next=b.t1===Ce.CANCEL||b.t1===Ce.REJECT?30:b.t1===Ce.ACCEPT?33:36;break;case 30:return b.next=32,Object(Se.b)(M(a.transferId));case 32:return b.abrupt("break",36);case 33:return b.next=35,Object(Se.a)((function(){return we(a,t)}));case 35:return b.abrupt("break",36);case 36:return b.abrupt("break",74);case 37:return b.next=39,Object(Se.b)((O=a.clients,{type:r.SET_NETWORK,value:O}));case 39:return b.abrupt("break",74);case 40:return o={type:Ne.PING,timestamp:(new Date).getTime()},b.next=43,Object(Se.b)(je(o));case 43:return b.abrupt("break",74);case 44:if("answer"!==a.data.type){b.next=49;break}return b.next=47,Object(Se.b)((d=a.transferId,f=a.data,{type:r.SET_REMOTE_DESCRIPTION,value:{transferId:d,data:f}}));case 47:b.next=51;break;case 49:return b.next=51,Object(Se.a)((function(){return ye(a,t)}));case 51:return b.abrupt("break",74);case 52:return b.next=54,Object(Se.b)(W(a.transferId,a.data));case 54:return b.abrupt("break",74);case 55:return b.next=57,Object(Se.c)((function(e){return e.privateKey}));case 57:if(!(u=b.sent)){b.next=73;break}return b.prev=59,b.t2=JSON,b.next=63,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.RSA.decryptString(u,a.payload);case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 63:if(b.t3=b.sent,!(l=b.t2.parse.call(b.t2,b.t3))||!l.type){b.next=69;break}return a.clientId&&(l.clientId=a.clientId),b.next=69,Object(Se.b)(Ee(l));case 69:b.next=73;break;case 71:b.prev=71,b.t4=b.catch(59);case 73:return b.abrupt("break",74);case 74:case"end":return b.stop()}var d,f,O,j,E,p,x,N,C,T}),De,null,[[59,71]])}function Be(e){var t,n,c,a,s,i;return he.a.wrap((function(o){for(;;)switch(o.prev=o.next){case 0:if(t=e.value,n=!!t.secure,delete t.secure,!("targetId"in t)){o.next=21;break}return o.next=6,Object(Se.c)((function(e){return e.network}));case 6:if(c=o.sent,!(a=null===c||void 0===c?void 0:c.find((function(e){return e.clientId===t.targetId})))||!a.publicKey){o.next=21;break}return o.prev=9,o.next=12,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,me.RSA.encryptString(a.publicKey,JSON.stringify(t));case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}}),e)}))));case 12:return s=o.sent,i={type:Ne.ENCRYPTED,targetId:t.targetId,payload:s},o.next=16,Object(Se.b)({type:r.WS_SEND_MESSAGE,value:i});case 16:return o.abrupt("return");case 19:o.prev=19,o.t0=o.catch(9);case 21:if(!n){o.next=23;break}return o.abrupt("return");case 23:return o.next=25,Object(Se.b)({type:r.WS_SEND_MESSAGE,value:t});case 25:case"end":return o.stop()}}),ge,null,[[9,19]])}function He(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Se.b)(se(!0));case 2:case"end":return e.stop()}}),Me)}function Xe(e){var t,n;return he.a.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.next=2,Object(Se.c)((function(e){return e.publicKey}));case 2:return t=r.sent,n={type:Ne.NAME,networkName:e.value,publicKey:t},r.next=6,Object(Se.b)(je(n));case 6:case"end":return r.stop()}}),Le)}function Ze(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Se.b)(se(!1));case 2:case"end":return e.stop()}}),Pe)}function qe(e){var t,n,r,a,s;return he.a.wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(t=e.value.file,n=void 0,!t.type.startsWith("image/")){i.next=9;break}return i.next=5,Object(Se.c)((function(e){return e.maxSize}));case 5:return r=i.sent,i.next=8,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){var n,c;return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object(_e.fromImage)(t);case 3:return(n=e.sent).thumbnail(100,!0),e.next=7,n.toDataURL();case 7:if(!((c=e.sent).length<.75*r)){e.next=10;break}return e.abrupt("return",c);case 10:e.next=14;break;case 12:e.prev=12,e.t0=e.catch(0);case 14:return e.abrupt("return",void 0);case 15:case"end":return e.stop()}}),e,null,[[0,12]])}))));case 8:n=i.sent;case 9:return a={file:t,fileName:t.name,fileSize:t.size,fileType:t.type||"application/octet-stream",transferId:Object(Re.a)(),clientId:e.value.clientId,state:c.OUTGOING,receiving:!1,preview:n},i.next=12,Object(Se.b)(D(a));case 12:return s={type:Ne.TRANSFER,transferId:a.transferId,fileName:a.fileName,fileSize:a.fileSize,fileType:a.fileType,targetId:a.clientId,preview:n},i.next=15,Object(Se.b)(je(s));case 15:case"end":return i.stop()}}),Ge)}function Qe(e){var t,n,r,c;return he.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,Object(Se.c)((function(e){return e.transfers}));case 2:if(t=a.sent,n=t.filter((function(t){return t.transferId===e.value})),0!==n.length){a.next=6;break}return a.abrupt("return");case 6:if(r=n[0]){a.next=9;break}return a.abrupt("return");case 9:if(r.peerConnection)try{r.peerConnection.close()}catch(s){}return c={type:Ne.ACTION,transferId:r.transferId,targetId:r.clientId,action:Ce.CANCEL},a.next=13,Object(Se.b)(je(c));case 13:return a.next=15,Object(Se.b)(M(e.value));case 15:case"end":return a.stop()}}),Fe)}function $e(e){var t,n,r,a;return he.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(Se.c)((function(e){return e.transfers}));case 2:if(t=s.sent,n=t.filter((function(t){return t.state===c.INCOMING&&t.transferId===e.value})),0!==n.length){s.next=6;break}return s.abrupt("return");case 6:if(r=n[0]){s.next=9;break}return s.abrupt("return");case 9:return a={type:Ne.ACTION,transferId:r.transferId,targetId:r.clientId,action:Ce.ACCEPT},s.next=12,Object(Se.b)(je(a));case 12:return s.next=14,Object(Se.b)(g({transferId:e.value,state:c.CONNECTING}));case 14:case"end":return s.stop()}}),We)}function et(e){var t,n,r,a;return he.a.wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,Object(Se.c)((function(e){return e.transfers}));case 2:if(t=s.sent,n=t.filter((function(t){return t.state===c.INCOMING&&t.transferId===e.value})),0!==n.length){s.next=6;break}return s.abrupt("return");case 6:if(r=n[0]){s.next=9;break}return s.abrupt("return");case 9:return a={type:Ne.ACTION,transferId:r.transferId,targetId:r.clientId,action:Ce.REJECT},s.next=12,Object(Se.b)(je(a));case 12:return s.next=14,Object(Se.b)(M(e.value));case 14:case"end":return s.stop()}}),Ue)}function tt(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(Se.a)((function(){return localStorage.setItem("welcomed","1")}));case 2:case"end":return e.stop()}}),Ke)}function nt(){var e,t;return he.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,Object(Se.c)((function(e){return e.transfers}));case 2:e=n.sent,(t=e.filter((function(e){return e.state===c.INCOMING}))).length>0?document.title="("+t.length+") OpenDrop":document.title="OpenDrop";case 5:case"end":return n.stop()}}),ze)}function rt(){var e;return he.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Se.a)(Object(Ie.a)(he.a.mark((function e(){return he.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,me.RSA.randomKeyPair();case 3:return e.abrupt("return",e.sent);case 6:return e.prev=6,e.t0=e.catch(0),e.abrupt("return",void 0);case 9:case"end":return e.stop()}}),e,null,[[0,6]])}))));case 2:if(!(e=t.sent)){t.next=6;break}return t.next=6,Object(Se.b)((n=e.publicKey,c=e.privateKey,{type:r.SET_KEY_PAIR,value:{publicKey:n,privateKey:c}}));case 6:return t.next=8,Object(Se.b)({type:r.WS_CONNECT,value:null});case 8:case"end":return t.stop()}var n,c}),Ye)}function ct(e){return he.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Se.a)((function(){return rt()}));case 2:return t.next=4,Object(Se.d)(r.DISMISS_WELCOME,tt);case 4:return t.next=6,Object(Se.d)(r.WS_MESSAGE,he.a.mark((function t(n){return he.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,Object(Se.a)((function(){return Ve(n,e)}));case 2:case"end":return t.stop()}}),t)})));case 6:return t.next=8,Object(Se.d)(r.PREPARE_MESSAGE,Be);case 8:return t.next=10,Object(Se.d)(r.WS_CONNECTED,He);case 10:return t.next=12,Object(Se.d)(r.WS_DISCONNECTED,Ze);case 12:return t.next=14,Object(Se.d)(r.SET_NETWORK_NAME,Xe);case 14:return t.next=16,Object(Se.d)(r.CREATE_TRANSFER,qe);case 16:return t.next=18,Object(Se.d)(r.CANCEL_TRANSFER,Qe);case 18:return t.next=20,Object(Se.d)(r.ACCEPT_TRANSFER,$e);case 20:return t.next=22,Object(Se.d)(r.REJECT_TRANSFER,et);case 22:return t.next=24,Object(Se.d)([r.ADD_TRANSFER,r.UPDATE_TRANSFER,r.REMOVE_TRANSFER,r.SET_NETWORK],nt);case 24:case"end":return t.stop()}}),Je)}var at=function(){var e=Object(fe.a)(),t=Object(de.c)(Te,Object(de.a)(pe(O),e));return e.run(ct,t.dispatch),t}();o.a.render(Object(d.jsx)(s.a.StrictMode,{children:Object(d.jsx)(u.a,{store:at,children:Object(d.jsx)(be,{})})}),document.getElementById("root"))}},[[200,1,2]]]);
//# sourceMappingURL=main.1f71de02.chunk.js.map